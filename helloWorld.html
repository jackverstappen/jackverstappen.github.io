<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="stylesheet" href="https://unpkg.com/@atlaskit/css-reset@2.0.0/dist/bundle.css" media="all">
        <script src="https://connect-cdn.atl-paas.net/all.js" async></script>
        <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    </head>
    <body>
        <section id="content" class="ac-content">
            <h1>Hello World and vega</h1>
            <div id="view"></div>
        </section>
    <script type="text/javascript">
      var view;

      //fetch('https://vega.github.io/vega/examples/bar-chart.vg.json')
      fetch('/bar-chart.vg.json')
        .then(res => res.json())
        .then(spec => render(spec))
        .catch(err => console.error(err));


      function render(spec) {
//        console.log(AP.cookie);
//        AP.require('request', function(request){
//          console.log("what: "+request);
//          request({
//            url: '/rest/api/2/project',
//            success: function (response){console.log("success: "+response);},
//            error:function (error){console.log("error"); console.log(error)}
//          });
//        });
      AP.request('/rest/api/2/myself')
        .then(data => alert(data.body))
        .catch(e => alert(e.err));

        console.log(spec.data);
        view = new vega.View(vega.parse(spec), {
          renderer:  'canvas',  // renderer (canvas or svg)
          container: '#view',   // parent DOM container
          hover:     true       // enable hover processing
        });
        return view.runAsync();
      }
    </script>
    </body>
</html>
